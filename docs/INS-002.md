# INS-002: 系统边界划分与架构定位 (CTS vs CTS_Grid)

## 1. 核心问题背景
随着整体量化交易生态的扩大，系统库正在经历从“单体应用”到“微服务/多智能体网络”的重构与边界划分。
目前存在两个核心级项目：
- **CTS (位于 WSL)**：基于 Node.js/Next.js 等前端及多智能体框架构建的项目。
- **CTS_Grid (位于 C盘，当前项目)**：基于 Python 以及 Pandas 等构建的执行引擎与单体回测系统。

必须要给这两个项目划定绝对清晰的边界与职责，才能实现最终的“技能链条与多智能体协同调用”。

## 2. 系统定位与职责剥离

### 2.1 CTS (WSL) —— 【战略指挥中心 & 多智能体中枢】
**角色图谱**：业务大前端、客户经理、高级量化研究团队。
- **核心职能**：
  - 承载整个应用的 Web UI（如 Next.js 编写的竞技场 `/arena`、协同作战室 `/squad` 等炫酷大屏）。
  - 处理用户的自然语言意图，并驱动底层的基础 Agent 协作网络。
  - 管理 Agent 群体记忆（Handover、History）。
  - 加载和派发 Skill (MCP)，指导 Agent 如何调用下游工具。
- **不应越界的行为**：
  - 不包含直接连接 OKX 交易所下买卖单的代码。
  - 不直接运行消耗 CPU/内存 的行情数据切片或 Pandas 技术指标计算（如 MA/RSI）。

### 2.2 CTS_Grid (当前 Python 项目) —— 【战术执行兵 & 领域专精工具】
**角色图谱**：交易引擎核心、纯后端计算节点、底层能力提供者。
- **核心职能**：
  - 管理 API Key 及长连接底座，直接面对交易所 API（挂单、撤单、查余额）。
  - 执行硬核的“数学及算力运算”（例如：加载几年的 K线数据跑 Grid Backtest、计算实时的移动平均线死叉）。
  - 将复杂的量化状态，封装并暴露出“标准化的 API 接口 (JSON)”。
- **当前网页 Dashboard 的极简定位**：
  - 当前项目自带的 `dashboard.html` 及聊天框**不需要**做成华丽的 To-C 级应用。
  - 它的职能仅仅是**给工程师（比如您和我）打辅助的“测试桩（Test Mock）”**。
  - 我们在这个简陋的本地前端里测试跑通了 LLM 怎么发策略、系统怎么接策略；一旦跑通，这个接口就直接给 WSL 里的 CTS Agent 以网络请求的方式调用。

## 3. “技能（Skill / MCP）”的跨域调用蓝图
通过明确以上定位，我们将实现极致的解耦与强强联合。

**完整的交互数据流**：
1. 【人类】在 `CTS` (WSL, Next.js) 的酷炫网页中发文字：“我想对 BTC 开个网格，你看看参数怎么设”。
2. 【CTS 系统】的 Agent 群体收到消息，经过简短内部辩论，确定意图为“组网格+回测”。
3. 【CTS 系统】提取其 `Skill Factory` 中现成的 `Call_Grid_System_SKILL` 技能手册。
4. 【CTS 系统】根据手册，通过局域网/互联网 HTTP 协议，向本 Windows 机器的 `CTS_Grid (Python /server.py)` 发送标准的 JSON Payload 载荷。
5. 【CTS_Grid (Python)】接单！瞬间利用本地算力和历史 K 线计算出回测结果，通过 JSON 再还给 CTS 系统。
6. 【CTS 系统】将数字解析整理成精美的语言或图表，展现在网页端。

## 4. 结论与当前开发指导原则
**在 `CTS_Grid` 里，不要越界去写闲聊交互和复杂的记忆管理。**
我们目前所在的 `feature/ai-assistant` 分支，所有的开发焦点都必须集中在：
**将量化引擎的能力剥离出纯粹的 API，并搭建一层轻量级的 OpenAI/LLM 请求网关（用来把那些杂乱意图转化为内部引擎的方法调用）。**

这个 Python 工程的最终宿命，就是成为智能体世界里，最硬核、最底层的“交易操作台神级 Tool”。
